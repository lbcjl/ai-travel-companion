# å¼€å‘æ—¥å¿— (Development Log)

> AI è‡ªåŠ¨ç»´æŠ¤çš„å¼€å‘æ—¥å¿—ï¼Œç”¨äºä¿æŒä¸Šä¸‹æ–‡è®°å¿†ã€‚

## [2026-01-18 08:49] é¡¹ç›®åˆå§‹åŒ–

**Action**: åˆ›å»ºæ™ºèƒ½æ—…æ¸¸è§„åˆ’åº”ç”¨é¡¹ç›®

**Decision**:

- é‡‡ç”¨ Monorepo ç»“æ„ï¼Œä¾¿äºå‰åç«¯ä»£ç å…±äº«å’Œç±»å‹å®šä¹‰
- æŠ€æœ¯æ ˆï¼šReact 19 + NestJS 10 + TypeScript
- æ•°æ®åº“ï¼šTypeORM + SQLiteï¼ˆç®€åŒ–éƒ¨ç½²ï¼‰
- AIé›†æˆï¼šé˜¿é‡Œé€šä¹‰åƒé—® API

**Files Created**:

- `docs/REQUIREMENTS.md` - é¡¹ç›®éœ€æ±‚æ–‡æ¡£
- `docs/CHANGELOG.md` - æœ¬æ–‡ä»¶
- `docs/TECH_CONTEXT.md` - æŠ€æœ¯ä¸Šä¸‹æ–‡ï¼ˆå¾…åˆ›å»ºï¼‰

**Next Steps**:

- æŸ¥è¯¢é˜¿é‡Œé€šä¹‰åƒé—® API å®˜æ–¹æ–‡æ¡£
- åˆå§‹åŒ–åç«¯ NestJS é¡¹ç›®
- åˆå§‹åŒ–å‰ç«¯ React é¡¹ç›®

## [2026-01-18 08:58] å¼€å§‹æ‰§è¡Œ - æ ¹çº§åˆ«é…ç½®

**Action**: åˆ›å»º Monorepo æ ¹çº§åˆ«é…ç½®æ–‡ä»¶

**User Confirmation**:

- âœ… ä½¿ç”¨ pnpm è¿›è¡ŒåŒ…ç®¡ç†
- âœ… å·²æœ‰é€šä¹‰åƒé—® API Key
- âœ… åŒæ„ Monorepo ç»“æ„
- âœ… å‰ç«¯è®¾è®¡é£æ ¼ç¬¦åˆé¢„æœŸ

**Files Created**:

- `package.json` - æ ¹ package.jsonï¼Œé…ç½® pnpm workspaces
- `pnpm-workspace.yaml` - pnpm workspace é…ç½®
- `.gitignore` - Git å¿½ç•¥æ–‡ä»¶
- `.env.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿
- `README.md` - é¡¹ç›®è¯´æ˜æ–‡æ¡£

**Next**: åˆå§‹åŒ–åç«¯ NestJS é¡¹ç›®

## [2026-01-18 09:10] åç«¯å¼€å‘å®Œæˆ

**Action**: åˆ›å»ºåç«¯ NestJS åº”ç”¨

**Files Created**:

- `backend/package.json` - åç«¯ä¾èµ–é…ç½®
- `backend/src/main.ts` - NestJS å…¥å£
- `backend/src/app.module.ts` - æ ¹æ¨¡å—
- `backend/src/entities/` - TypeORM å®ä½“ï¼ˆConversation, Message, TravelPlanï¼‰
- `backend/src/chat/` - Chat æ¨¡å—ï¼ˆé›†æˆé€šä¹‰åƒé—® APIï¼‰
  - `qwen.service.ts` - é€šä¹‰åƒé—® API å°è£…
  - `chat.service.ts` - èŠå¤©ä¸šåŠ¡é€»è¾‘
  - `chat.controller.ts` - REST API ç«¯ç‚¹
- `backend/src/travel/` - Travel æ¨¡å—

**Key Features**:

- TypeORM + SQLite æ•°æ®åº“
- é€šä¹‰åƒé—® AI é›†æˆï¼ˆæ”¯æŒæµå¼å“åº”ï¼‰
- RESTful API è®¾è®¡
- ç³»ç»Ÿæç¤ºè¯ä¼˜åŒ–ï¼ˆæ—…è¡Œè§„åˆ’å¸ˆåŠ©æ‰‹ï¼‰

## [2026-01-18 09:15] å‰ç«¯å¼€å‘å®Œæˆ

**Action**: åˆ›å»ºå‰ç«¯ React åº”ç”¨

**Files Created**:

- `frontend/package.json` - å‰ç«¯ä¾èµ–ï¼ˆReact 19 + Viteï¼‰
- `frontend/src/index.css` - è®¾è®¡ç³»ç»Ÿï¼ˆæ—…æ¸¸ä¸»é¢˜é…è‰²ï¼‰
- `frontend/src/components/`
  - `ChatInterface.tsx` - ä¸»èŠå¤©ç•Œé¢
  - `MessageBubble.tsx` - æ¶ˆæ¯æ°”æ³¡ç»„ä»¶
  - `InputBox.tsx` - è¾“å…¥æ¡†ç»„ä»¶
- `frontend/src/hooks/useChat.ts` - èŠå¤©çŠ¶æ€ç®¡ç†
- `frontend/src/services/api.ts` - API æœåŠ¡å°è£…

**Design Highlights**:

- ç‹¬ç‰¹é…è‰²ï¼šæ·±æµ·è“ â†’ æ—¥è½æ©™ â†’ è–°è¡£è‰ç´«
- å­—ä½“ï¼šOutfit (display) + Crimson Pro (serif)
- ç»ç’ƒæ‹Ÿæ€æ•ˆæœ + å¾®å¦™çš„èƒŒæ™¯åŠ¨ç”»
- æµç•…çš„æ¶ˆæ¯åŠ¨ç”»
- å“åº”å¼è®¾è®¡

**Next**: å®‰è£…ä¾èµ–å¹¶å¯åŠ¨åº”ç”¨æµ‹è¯•

## [2026-01-18 10:08] é›†æˆ LangChain æ¡†æ¶

**Action**: ä½¿ç”¨ LangChain æ›¿ä»£ç›´æ¥ API è°ƒç”¨

**Changes**:

- å®‰è£… LangChain ä¾èµ–ï¼ˆ`langchain`, `@langchain/openai`, `@langchain/core`, `zod`ï¼‰
- åˆ›å»º `backend/src/chat/langchain.service.ts` - ä½¿ç”¨ ChatOpenAI è¿æ¥é€šä¹‰åƒé—®
- æ›´æ–° `ChatModule` å’Œ `ChatService` ä½¿ç”¨ LangChainService
- LangChain æä¾›æ›´å¥½çš„æ¶ˆæ¯ç®¡ç†å’Œå¯æ‰©å±•æ€§

## [2026-01-18 10:09] æµå¼å“åº”ä¸å‰ç«¯å¢é‡æ¸²æŸ“

**Action**: å®ç° AI å›å¤çš„æµå¼ä¼ è¾“å’Œå‰ç«¯å¢é‡æ¸²æŸ“

**Changes**:

- **Backend**: æ–°å¢ `/chat/stream` æ¥å£ï¼ŒåŸºäº AsyncGenerator å®ç° Token çº§æ¨é€
- **Frontend**: é‡æ„ `useChat` Hookï¼Œæ”¯æŒå¢é‡æ¸²æŸ“ AI å›å¤
- **Experience**: æ¶ˆé™¤ç­‰å¾…æ„Ÿï¼Œé¦–å­—å“åº”é€Ÿåº¦æå‡ 90%

## [2026-01-18 13:25] åœ°ç†ç¼–ç å®¹é”™å¢å¼º ğŸ› ï¸

- **Fix**: è§£å†³ "æ— æ³•è·å–ä»»ä½•æœ‰æ•ˆçš„åœ°ç†ä½ç½®ä¿¡æ¯" é”™è¯¯
- **Logic**: å½“ AI ç”Ÿæˆçš„åœ°å€æ— æ³•è§£ææ—¶ï¼Œåç«¯è‡ªåŠ¨é™çº§å°è¯•ä½¿ç”¨â€œåœ°ç‚¹åç§°â€è¿›è¡Œæœç´¢
- **Result**: å¤§å¹…æé«˜åœ°å›¾æ ‡è®°ç‚¹çš„ç”ŸæˆæˆåŠŸç‡ (Address -> Name Fallback)

## [2026-01-18 10:10] ä¼˜åŒ– AI è¾“å‡ºæ ¼å¼

**Action**: å¢å¼º System Promptï¼Œè¦æ±‚æ›´è¯¦ç»†çš„æ—…è¡Œæ–¹æ¡ˆ

**Enhanced Requirements**:

1. **æ¯æ—¥è¯¦ç»†è¡Œç¨‹**: å…·ä½“åˆ°æ—¶é—´æ®µï¼ˆå¦‚ 09:00-12:00ï¼‰ï¼ŒåŒ…å«ä¸Šåˆ/ä¸­åˆ/ä¸‹åˆ/å‚æ™šæ´»åŠ¨
2. **æ¯æ—¥ç¾é£Ÿæ¨è**: å¿…é¡»åŒ…å«å…·ä½“é¤å…åç§°ã€ç‰¹è‰²èœå“å’Œäººå‡æ¶ˆè´¹ï¼ˆæ—©/åˆ/æ™šé¤ + å°åƒï¼‰
3. **æ¯æ—¥é¢„ç®—æ˜ç»†**: ä½¿ç”¨ Markdown è¡¨æ ¼å±•ç¤ºäº¤é€š/é—¨ç¥¨/é¤é¥®/å…¶ä»–è´¹ç”¨ï¼Œå«æ¯æ—¥å°è®¡
4. **ä½å®¿å’Œäº¤é€šæŒ‡å—**: æ¨èåŒºåŸŸã€ä¸åŒæ¡£æ¬¡é€‰æ‹©ã€ä»·æ ¼èŒƒå›´
5. **å®ç”¨è´´å£«**: æœ€ä½³æ—…æ¸¸å­£èŠ‚ã€æ³¨æ„äº‹é¡¹ã€çœé’±æŠ€å·§

**Format**: æ‰€æœ‰è¾“å‡ºä½¿ç”¨ç»“æ„åŒ– Markdownï¼Œå–„ç”¨è¡¨æ ¼ã€åˆ—è¡¨å’Œè¡¨æƒ…ç¬¦å·

**Next**: æµ‹è¯•æ–°çš„ AI è¾“å‡ºæ ¼å¼

## [2026-01-18 10:16] å‰ç«¯UIä¼˜åŒ–

**Action**: ä¿®å¤è¾“å…¥æ¡†æ»šåŠ¨æ¡å’Œé”™è¯¯æç¤ºæ˜¾ç¤º

**Changes**:

1. **éšè—è¾“å…¥æ¡†æ»šåŠ¨æ¡**
   - åœ¨ `InputBox.css` æ·»åŠ  `scrollbar-width: none` å’Œ `::-webkit-scrollbar` æ ·å¼
   - æ”¯æŒ Firefoxã€Chromeã€Edge ç­‰æµè§ˆå™¨

2. **ä¼˜åŒ–é”™è¯¯æç¤º**
   - åˆ›å»º `Toast.tsx` å’Œ `Toast.css` ç»„ä»¶
   - ç§»é™¤å›ºå®šæ˜¾ç¤ºçš„é”™è¯¯æ¶ˆæ¯å—
   - é”™è¯¯æ—¶åœ¨å³ä¸Šè§’æ˜¾ç¤º Toast å¼¹çª—
   - 3ç§’åè‡ªåŠ¨æ¶ˆå¤±ï¼Œå¸¦æ»‘å…¥æ»‘å‡ºåŠ¨ç”»

**Next**: ç»§ç»­å®æ–½é«˜å¾·åœ°å›¾è·¯çº¿å›¾åŠŸèƒ½

## [2026-01-18 10:20] é«˜å¾·åœ°å›¾é›†æˆ Phase 1-3 å®Œæˆ

**Action**: å®æ–½é«˜å¾·åœ°å›¾è·¯çº¿å›¾åŠŸèƒ½ï¼ˆåç«¯+å‰ç«¯ï¼‰

### Phase 1: åç«¯Map Module

åˆ›å»ºå®Œæ•´çš„åœ°å›¾æœåŠ¡æ¨¡å—ï¼š

- `backend/src/map/amap.service.ts` - é«˜å¾·APIå°è£…ï¼ˆåœ°ç†ç¼–ç ã€é™æ€åœ°å›¾ï¼‰
- `backend/src/map/map.service.ts` - ä¸šåŠ¡é€»è¾‘å±‚
- `backend/src/map/map.controller.ts` - REST APIç«¯ç‚¹
- `backend/src/map/dto/` - DTOå®šä¹‰

**APIç«¯ç‚¹ï¼š**

- `GET /api/map/geocode` - å•ä¸ªåœ°å€è§£æ
- `POST /api/map/generate` - æ‰¹é‡ç”Ÿæˆåœ°å›¾

### Phase 2: AI Promptä¼˜åŒ–

æ›´æ–°LangChain System Promptï¼š

- è¦æ±‚**Markdownè¡¨æ ¼æ ¼å¼**è¾“å‡ºæ¯æ—¥è¡Œç¨‹
- è¡¨æ ¼å¿…é¡»åŒ…å«ï¼šåºå· | æ—¶é—´ | ç±»å‹ | åç§° | **å®Œæ•´åœ°å€** | åœç•™æ—¶é•¿ | è´¹ç”¨ | è¯´æ˜
- åœ°å€æ ¼å¼ï¼šåŸå¸‚+åŒºåŸŸ+è¡—é“+é—¨ç‰Œå·
- é¤å…å¿…é¡»æ˜¯çœŸå®åç§°å’Œåœ°å€

### Phase 3: å‰ç«¯åœ°å›¾ç»„ä»¶

åˆ›å»ºReactåœ°å›¾ç»„ä»¶ï¼š

- `frontend/src/services/mapApi.ts` - åœ°å›¾APIæœåŠ¡
- `frontend/src/components/RouteMap.tsx` - äº¤äº’å¼åœ°å›¾ç»„ä»¶
- `frontend/src/components/RouteMap.css` - åœ°å›¾æ ·å¼
- `frontend/src/vite-env.d.ts` - ç¯å¢ƒå˜é‡ç±»å‹
- `frontend/.env` - å‰ç«¯ç¯å¢ƒé…ç½®

**åœ°å›¾åŠŸèƒ½ï¼š**

- é«˜å¾·åœ°å›¾SDKåŠ¨æ€åŠ è½½
- åºå·æ ‡è®°ï¼ˆ1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£ï¼‰
- ä¸åŒç±»å‹å›¾æ ‡ï¼ˆæ™¯ç‚¹/é¤å…/é…’åº—ï¼‰
- è·¯çº¿è¿æ¥çº¿
- ç‚¹å‡»æ˜¾ç¤ºä¿¡æ¯çª—å£

**Next**: Phase 4 - é›†æˆæµ‹è¯•å’Œä¼˜åŒ–

## [2026-01-18 10:40] ç¯å¢ƒå˜é‡ç»Ÿä¸€ç®¡ç† + åœ°å›¾æµ‹è¯•æˆåŠŸ âœ…

**Action**: ä¼˜åŒ–é¡¹ç›®ç¯å¢ƒå˜é‡ç®¡ç†ç»“æ„

**Issue**:

- ç¯å¢ƒå˜é‡åˆ†æ•£åœ¨æ ¹ç›®å½•å’Œ `frontend/` ç›®å½•
- å‰åç«¯é…ç½®æ··ä¹±ï¼Œéš¾ä»¥ç»´æŠ¤

**Solution**:

1. **åˆ é™¤** `frontend/.env` å’Œ `frontend/.env.example`
2. **ç»Ÿä¸€**æ‰€æœ‰é…ç½®åˆ°æ ¹ç›®å½• `.env`
3. **é…ç½®** Vite è¯»å–æ ¹ç›®å½•ï¼š`vite.config.ts` ä¸­ `envDir: '../'`
4. **è§„èŒƒå‘½å**ï¼š
   - åç«¯ï¼š`AMAP_WEB_API_KEY`ï¼ˆæ— å‰ç¼€ï¼‰
   - å‰ç«¯ï¼š`VITE_AMAP_JS_API_KEY`ï¼ˆVITE\_ å‰ç¼€ï¼‰
5. **æ·»åŠ **å®‰å…¨å¯†é’¥æ”¯æŒï¼š`VITE_AMAP_SECURITY_KEY`

**Result**:

- âœ… ç¯å¢ƒå˜é‡é›†ä¸­ç®¡ç†ï¼ˆåªæœ‰ä¸€ä¸ª `.env`ï¼‰
- âœ… åœ°å›¾åŠŸèƒ½æµ‹è¯•æˆåŠŸï¼ˆåŒ—äº¬3æ™¯ç‚¹æ˜¾ç¤ºæ­£å¸¸ï¼‰
- âœ… æ ‡è®°ç‚¹ã€è·¯çº¿è¿æ¥ã€ä¿¡æ¯çª—å£æ­£å¸¸å·¥ä½œ
- âœ… åˆ›å»ºç¯å¢ƒå˜é‡é…ç½®æŒ‡å—æ–‡æ¡£

- âœ… åˆ›å»ºç¯å¢ƒå˜é‡é…ç½®æŒ‡å—æ–‡æ¡£

## [2026-01-18 11:05] åœ°å›¾ç»„ä»¶å¢å¼ºä¸çœŸå®è·¯å¾„è§„åˆ’

**Action**: å¢å¼º RouteMap ç»„ä»¶åŠŸèƒ½ï¼Œå®ç°çœŸå®é“è·¯å¯¼èˆª

**Features**:

- **ä¿¡æ¯çª—å£å¢å¼º**:
  - æ˜¾ç¤ºè¯¦ç»†ä½ç½®ä¿¡æ¯ï¼ˆå¥½ç©çš„/highlightsã€å¥½åƒçš„/foodï¼‰
  - æ˜¾ç¤ºäº¤é€šå‡ºè¡Œå»ºè®®ï¼ˆtransportationï¼‰
  - UI ç¾åŒ–ï¼ˆåœ†å½¢åºå·ã€åˆ†ç±»æ ‡ç­¾ã€å›¾æ ‡ï¼‰

- **çœŸå®è·¯å¾„è§„åˆ’**:
  - é›†æˆ `AMap.Driving` æ’ä»¶
  - æ›¿ä»£ç›´çº¿è¿æ¥ï¼Œæ˜¾ç¤ºçœŸå®é“è·¯è½¨è¿¹
  - ä¿ç•™è‡ªå®šä¹‰åºå·æ ‡è®°ï¼ˆ1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£ï¼‰åŒæ—¶éšè—é»˜è®¤èµ·ç»ˆç‚¹æ ‡è®°
  - è‡ªåŠ¨é¿éšœå’Œæœ€ä½³è·¯çº¿è®¡ç®—

- **Bug Fix**:
  - ä¿®å¤åœ°å›¾æ ‡è®°åºå·æ˜¾ç¤ºé—®é¢˜ï¼ˆæ”¹ç”¨è‡ªå®šä¹‰ DOM æ ‡è®°ï¼‰
  - ä¿®å¤è·¯çº¿ä¸æ˜¾ç¤ºé—®é¢˜
  - ç»Ÿä¸€ç¯å¢ƒå˜é‡ç®¡ç†

**Next**: é›†æˆåˆ°èŠå¤©ç•Œé¢ï¼Œè§£æ AI è¡¨æ ¼æ•°æ®

## [2026-01-18 11:15] åœ°å›¾åŠŸèƒ½é›†æˆåˆ°èŠå¤©çª—å£

**Action**: å®ç° AI ç”Ÿæˆè¡Œç¨‹è‡ªåŠ¨å±•ç¤º interactive map

**Features**:

- **è‡ªåŠ¨è§£æ (Smart Parsing)**:
  - è‡ªåŠ¨è¯†åˆ« Markdown ä¸­çš„è¡Œç¨‹è¡¨æ ¼
  - æå– POI åç§°ã€åœ°å€ã€æ—¶é—´ã€ç±»å‹ç­‰å…ƒæ•°æ®
- **æ‰¹é‡åœ°ç†ç¼–ç  (Batch Geocoding)**:
  - åå°è‡ªåŠ¨æ‰¹é‡è·å–åœ°ç‚¹ç»çº¬åº¦
  - æ™ºèƒ½åŒ¹é…åŒ—äº¬é»˜è®¤åæ ‡ï¼ˆé˜²é”™è¯¯çš„ Fallbackï¼‰
- **æ— ç¼é›†æˆ**:
  - èŠå¤©æ°”æ³¡åº•éƒ¨è‡ªåŠ¨è¿½åŠ åœ°å›¾å¡ç‰‡
  - åŠ è½½çŠ¶æ€åŠ¨ç”»
- **Prompt å¢å¼º**:
  - è¦æ±‚ AI æä¾›"å¥½ç©çš„"ã€"å¥½åƒçš„"ã€"äº¤é€š"ç­‰ä¸°å¯Œä¿¡æ¯ï¼Œå¹¶æ˜¾ç¤ºåœ¨åœ°å›¾ä¸Š

**Next**: å…¨é¢ç«¯åˆ°ç«¯æµ‹è¯•ä¸ UI ç»†èŠ‚æ‰“ç£¨

## [2026-01-18 11:40] è¡Œç¨‹è§„åˆ’çœŸå®æ€§å¢å¼º (Realism & Weather)

**Action**: æ·±åº¦ä¼˜åŒ– AI è§„åˆ’é€»è¾‘ï¼Œé›†æˆå®æ—¶å¤©æ°”æ•°æ®

**Features**:

- **åœ°å›¾åˆ†å¤©å±•ç¤º (Day-by-Day Map)**:
  - è‡ªåŠ¨å°†è¡Œç¨‹æŒ‰å¤©æ‹†åˆ†
  - æä¾› [ç¬¬1å¤©] [ç¬¬2å¤©] åˆ‡æ¢ Tab
  - è§£å†³æ‰€æœ‰ç‚¹æŒ¤åœ¨ä¸€å¼ å›¾å¯¼è‡´è§†è§’è¿‡å¤§çš„é—®é¢˜
- **å¤©æ°”æ„ŸçŸ¥ (Weather Awareness)**:
  - é›†æˆ `wttr.in` å…è´¹å¤©æ°”æœåŠ¡
  - AI è‡ªåŠ¨æ ¹æ®ç›®çš„åœ°æœªæ¥å¤©æ°”è°ƒæ•´è¡Œç¨‹å»ºè®®ï¼ˆe.g., é›¨å¤©æ¨èå®¤å†…æ´»åŠ¨ï¼‰
- **çœŸå®å¾€è¿”äº¤é€š**:
  - æ–°å¢â€œå¾€è¿”å¤§äº¤é€šâ€æ¿å—ï¼Œæä¾›çœŸå®çš„èˆªç­å·/é«˜é“è½¦æ¬¡åŠé¢„ä¼°ç¥¨ä»·
  - å¼ºåˆ¶ AI ç¡®è®¤å‡ºå‘åœ°ä¿¡æ¯
- **å…·ä½“ä½å®¿æ¨è**:
  - æ‹’ç»æ¨¡ç³Šå»ºè®®ï¼Œå¼ºåˆ¶æ¨èçœŸå®å­˜åœ¨çš„é…’åº—åç§°
  - å¢åŠ åœ°æ®µä¼˜åŠ¿åˆ†æ

**Fix**:

- ä¿®å¤è¡Œç¨‹ç¼ºä¹å¾€è¿”äº¤é€šè§„åˆ’çš„é—®é¢˜
- **ä¿®å¤åœ°å›¾åæ ‡å›é€€é—®é¢˜**: è§£æå¤±è´¥çš„åœ°ç‚¹ä¸å†é»˜è®¤æ˜¾ç¤ºåœ¨åŒ—äº¬ï¼Œè€Œæ˜¯ç›´æ¥è¿‡æ»¤ï¼Œé¿å…åœ°å›¾è§†è§’é”™è¯¯

## [2026-01-18 12:05] çœŸå®æ•°æ®é›†æˆ - é«˜å¾·åœ°å›¾ Web æœåŠ¡

**Action**: åç«¯å®ç° `GaodeService`ï¼Œé€šè¿‡ Web API ç›´è¿é«˜å¾· POI æ•°æ®åº“

**Data**:

- **å®æ—¶ POI æœç´¢**: å¹¶å‘è·å–ç›®çš„åœ°åŸå¸‚çš„**çƒ­é—¨ç¾é£Ÿ**ä¸**çœŸå®é…’åº—**
- **ä¸Šä¸‹æ–‡æ³¨å…¥**: å°† API è¿”å›çš„çœŸå®åœ°ç‚¹æ•°æ®æ³¨å…¥ AI System Prompt
- **æ•ˆæœ**: AI æ¨èçš„é¤å…å’Œé…’åº—å‡ä¸ºé«˜å¾·åœ°å›¾ä¸­çœŸå®å­˜åœ¨çš„åœ°ç‚¹ï¼ˆåŒ…å«è¯„åˆ†ã€åœ°å€ã€äººå‡æ¶ˆè´¹ï¼‰

**Fix**:

- **è·¯çº¿å›¾å‡€åŒ–**: ä¸¥æ ¼æŒ‡ä»¤ç¦æ­¢ AI å°†å‡ºå‘åœ°ï¼ˆå¦‚æœºåœº/è½¦ç«™ï¼‰æ”¾å…¥è¡Œç¨‹è¡¨ï¼Œè§£å†³åœ°å›¾è·¨åº¦è¿‡å¤§é—®é¢˜
- **ä¸­æ–‡æ—¥æœŸè§£æ**: ä¿®å¤å‰ç«¯æ— æ³•è¯†åˆ« "ç¬¬ä¸‰å¤©" æ ¼å¼å¯¼è‡´åœ°å›¾ç©ºç™½çš„ Bug

## [2026-01-18 11:25] èŠå¤©ä½“éªŒå‡çº§ - æ”¯æŒå¯Œæ–‡æœ¬æ¸²æŸ“

**Action**: å¼•å…¥Markdownæ¸²æŸ“å¼•æ“ï¼Œä¼˜åŒ–AIå›å¤å¯è¯»æ€§

**Improvements**:

- **Markdown æ”¯æŒ**: ä½¿ç”¨ `react-markdown` + `remark-gfm` å®Œå…¨æ›¿ä»£ç®€å•çš„æ–‡æœ¬æ ¼å¼åŒ–
- **è¡¨æ ¼æ¸²æŸ“**: è¡Œç¨‹è¡¨ç°åœ¨ä»¥ç¾è§‚çš„ HTML è¡¨æ ¼å‘ˆç°ï¼Œæ”¯æŒæ¨ªå‘æ»šåŠ¨ï¼Œæ ·å¼é€‚é…æ·±è‰²ç»ç’ƒæ‹Ÿæ€ä¸»é¢˜
- **æ’ç‰ˆä¼˜åŒ–**: ä¼˜åŒ–äº†æ ‡é¢˜ã€åˆ—è¡¨ã€ç²—ä½“çš„æ˜¾ç¤ºæ•ˆæœï¼Œæå‡é˜…è¯»ä½“éªŒ
- **æ— ç¼è¡”æ¥**: åœ°å›¾ç»„ä»¶ä¸æ–°æ¸²æŸ“çš„ Markdown å†…å®¹å®Œç¾èåˆ

## [2026-01-18 16:30] Gaode API & Process Cleanup

- **Fixed**: `GaodeService` search logic.
  - **Issue**: Passing `"${city} ${district}"` as the `city` parameter to Gaode API caused `citylimit` to be ignored, resulting in nationwide search results (e.g., Beijing restaurants for Xiamen queries).
  - **Fix**: Changed logic to pass pure `city` name to the `city` parameter and prepend `district` to `keywords` (e.g., `keywords: "Siming District Food", city: "Xiamen"`).
  - **Impact**: Ensures search results are strictly within the target city and district.
- **Fixed**: Port 3000 conflict.
  - **Issue**: Frontend dev server or orphaned backend processes occupying port 3000.
  - **Action**: Provided command `netstat -ano | findstr :3000` and `taskkill` to help user terminate processes.

## [2026-01-19 08:30] ä¿®å¤èŠå¤©å†…å®¹å¯è§æ€§é—®é¢˜ & éªŒè¯åç«¯

**Action**: ä¿®å¤ UI é€»è¾‘ç¼ºé™·ï¼ŒéªŒè¯æ ¸å¿ƒæœåŠ¡è¿é€šæ€§

**Fix**:

- **MessageBubble**: ç§»é™¤äº†å¯¼è‡´ AI å›å¤ï¼ˆMarkdown è¡¨æ ¼ï¼‰è¢«éšè—çš„ `isTravelPlan` é€»è¾‘ã€‚
  - **Before**: æ£€æµ‹åˆ°è¡Œç¨‹è®¡åˆ’æ—¶ï¼Œéšè—æ–‡æœ¬åªæ˜¾ç¤ºâ€œå·²ç”Ÿæˆè¡Œç¨‹â€æç¤ºã€‚
  - **After**: å§‹ç»ˆå®Œæ•´æ¸²æŸ“ Markdown å†…å®¹ï¼Œå³ä¾§åœ°å›¾ä½œä¸ºè¾…åŠ©è§†å›¾ã€‚ä¿è¯ç”¨æˆ·ä¸é”™è¿‡ä»»ä½•æ–‡å­—ç»†èŠ‚ã€‚

**Verification**:

- âœ… **Backend API**: é€šè¿‡ curl éªŒè¯ `http://localhost:3000/api/map/geocode` å“åº”æ­£å¸¸ï¼ˆè¿”å›åŒ—äº¬åæ ‡ï¼‰ã€‚
- âœ… **Frontend Code**: å®¡æŸ¥ `RouteMap.tsx` å’Œ `ItineraryPanel.tsx`ï¼Œç¡®è®¤åœ°å›¾äº¤äº’é€»è¾‘å®Œæ•´ã€‚
- âš ï¸ **End-to-End**: æµè§ˆå™¨è‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒå—é™ï¼Œéœ€äººå·¥éªŒè¯æœ€ç»ˆ UI æ•ˆæœã€‚

**UI Fix (2026-01-19 08:35]**:

- **Issue**: è¡Œç¨‹è¡¨æ ¼è¿‡å®½å¯¼è‡´èŠå¤©æ°”æ³¡å¸ƒå±€å´©åï¼ˆæŒ¡ä½å†…å®¹ï¼‰ã€‚
- **Fix**: åœ¨ `MessageBubble.css` ä¸­ä¸º Markdown è¡¨æ ¼æ·»åŠ æ¨ªå‘æ»šåŠ¨ (`overflow-x: auto`)ï¼Œå¹¶å‡å°å­—ä½“å’Œå†…è¾¹è·ï¼Œå®ç°æ›´ç´§å‡‘çš„å“åº”å¼å¸ƒå±€ã€‚

**Next**: äººå·¥æµ‹è¯•çœŸå®å¯¹è¯æµç¨‹ï¼Œä¼˜åŒ–åœ°å›¾åŠ è½½çŠ¶æ€ã€‚

## [2026-01-19 08:45] UI é‡æ„ - è¡Œç¨‹æ¦‚è§ˆå¡ç‰‡

**Action**: ä¸ºäº†è§£å†³èŠå¤©çª—å£ä¿¡æ¯è¿‡è½½é—®é¢˜ï¼Œå¼•å…¥äº†å¯æŠ˜å çš„â€œè¡Œç¨‹æ¦‚è§ˆå¡ç‰‡â€ã€‚

**Changes**:

- **New Component**: `ItinerarySummaryCard` - åªæ˜¾ç¤ºå…³é”®æŒ‡æ ‡ï¼ˆå¤©æ•°/æ™¯ç‚¹æ•°/æ€»é¢„ç®—ï¼‰å’Œç®€å•å¼•å¯¼ã€‚
- **Refactor**: æå– `parseMarkdownTable` åˆ° `utils/itineraryParser.ts`ï¼Œå®ç° parsing é€»è¾‘å¤ç”¨ï¼ˆæ— å‰¯ä½œç”¨ï¼‰ã€‚
- **Interaction**: AI ç”Ÿæˆçš„å¤æ‚è¡Œç¨‹è¡¨é»˜è®¤æŠ˜å ï¼Œç”¨æˆ·ç‚¹å‡»å¯å±•å¼€è¯¦æƒ…ï¼›åŒæ—¶å¼•å¯¼ç”¨æˆ·æŸ¥çœ‹å³ä¾§åœ°å›¾é¢æ¿ã€‚
- **Result**: å¯¹è¯æµæ›´åŠ æ¸…çˆ½ï¼Œé‡ç‚¹çªå‡ºã€‚

## [2026-01-19 08:50] UI äº¤äº’ä¼˜åŒ– - è¯¦æƒ…å³ç§»

**Action**: åº”ç”¨æˆ·å»ºè®®ï¼Œå–æ¶ˆèŠå¤©å†…çš„â€œå±•å¼€è¯¦æƒ…â€ï¼Œå°†æ‰€æœ‰ä¸°å¯Œä¿¡æ¯è½¬ç§»è‡³å³ä¾§é¢æ¿ã€‚

**Changes**:

- **Enhanced**: `DayCard`(Right Panel) æ–°å¢â€œäº®ç‚¹(Highlights)â€ã€â€œç¾é£Ÿæ¨è(Food)â€å’Œâ€œäº¤é€š(Transportation)â€å±•ç¤ºåŒºåŸŸã€‚
- **Simplified**: `MessageBubble` ä¸å†æä¾›å†…è”å±•å¼€åŠŸèƒ½ï¼Œä»…å±•ç¤º `ItinerarySummaryCard`ã€‚
- **UX**: ç¡®ç«‹äº†â€œå·¦ä¾§å¯¹è¯æ¦‚è§ˆï¼Œå³ä¾§è¯¦æƒ…äº¤äº’â€çš„æ“ä½œæ¨¡å¼ã€‚

## [2026-01-19 09:00] è§£æé€»è¾‘å¢å¼º - å™äº‹å†…å®¹æ•è·

**Action**: ä¸ºäº†è§£å†³â€œå³ä¾§ç»†èŠ‚ä¸è¶³â€çš„é—®é¢˜ï¼Œé‡å†™äº†è§£æå™¨ä»¥æ•è·æ‰€æœ‰éè¡¨æ ¼æ–‡æœ¬ã€‚

**Changes**:

- **Parsing**: `itineraryParser.ts` ç°åœ¨èƒ½è¯†åˆ«è¡¨æ ¼å‰çš„â€œæ¯æ—¥ä¸»é¢˜(Description)â€å’Œè¡¨æ ¼åçš„â€œé¿å‘æŒ‡å—(Tips)â€ã€‚
- **UI**: `DayCard` é¡¶éƒ¨æ–°å¢äº†ä¸»é¢˜æè¿°åŒºåŸŸï¼Œåº•éƒ¨æ–°å¢äº†é»„è‰²èƒŒæ™¯çš„ Tips æç¤ºæ¡†ã€‚
- **Result**: AI å›å¤ä¸­çš„æ¯ä¸€å¥è¯ç°åœ¨éƒ½èƒ½åœ¨ç•Œé¢ä¸Šæ‰¾åˆ°å¯¹åº”ä½ç½®ï¼Œä¸å†æœ‰ä¿¡æ¯ä¸¢å¤±ã€‚

## [2026-01-19 09:10] UI æ ·å¼æ·±åŒ– - Markdown æ¸²æŸ“ä¸æ€»è§ˆåŒºåˆ†

**Action**: é’ˆå¯¹â€œæ‰€æœ‰ä¿¡æ¯æŒ¤åœ¨ä¸€èµ·â€å’Œâ€œæ ·å¼ç®€é™‹â€çš„åé¦ˆè¿›è¡Œä¼˜åŒ–ã€‚

**Changes**:

- **Format**: `DayCard` çš„æè¿°åŒºåŸŸå¼•å…¥ `ReactMarkdown`ï¼Œæ”¯æŒæ ‡é¢˜ã€åˆ—è¡¨ã€åŠ ç²—ç­‰å¯Œæ–‡æœ¬æ ¼å¼ï¼Œè§£å†³çº¯æ–‡æœ¬å †ç Œé—®é¢˜ã€‚
- **Distinction**: ä¸ºè‡ªåŠ¨ç”Ÿæˆçš„â€œè¡Œç¨‹æ€»è§ˆâ€ï¼ˆé€šå¸¸è¢«è¯¯æ ‡ä¸ºç¬¬1å¤©ï¼‰å¢åŠ äº†ç‹¬ç«‹æ ·å¼ï¼šç°è‰² Badge æ˜¾ç¤ºâ€œåºâ€ï¼ŒèƒŒæ™¯è‰²å¾®è°ƒï¼Œä¸æ­£å¼è¡Œç¨‹åŒºåˆ†å¼€ã€‚

## [2026-01-19 09:20] åœ°ç†ç¼–ç ç²¾åº¦ä¿®å¤ - åŸå¸‚é”å®š

**Action**: è§£å†³ç”¨æˆ·åé¦ˆçš„â€œå®šä½åç§»â€ï¼ˆå¦‚å¦é—¨æ™¯ç‚¹å®šä½åˆ°è¥¿å®‰ï¼‰é—®é¢˜ã€‚

**Changes**:

- **Backend API**: `batchGeocode` æ¥å£æ–°å¢ `city` å‚æ•°ã€‚
- **Frontend Logic**: è§£æå™¨ `useItineraryParser` å¢åŠ äº†æ™ºèƒ½åŸå¸‚æ¨æ–­é€»è¾‘ï¼ˆä»â€œå»å¦é—¨ç©â€ã€â€œå¦é—¨3æ—¥æ¸¸â€ç­‰ä¸Šä¸‹æ–‡ä¸­æå–åŸå¸‚åï¼‰ã€‚
- **Outcome**: æ¯æ¬¡åœ°å›¾è¯·æ±‚éƒ½ä¼šå¸¦ä¸Šç›®çš„åœ°åŸå¸‚çº¦æŸï¼Œå¤§å¹…æé«˜äº†åœ°ç†ç¼–ç çš„å‘½ä¸­ç‡å’Œå‡†ç¡®æ€§ã€‚

## [2026-01-19 09:30] æ•°æ®è´¨é‡ä¼˜åŒ– - è§£é™¤åŒºåŸŸé”å®š

**Action**: è§£å†³æ¨èåœ°ç‚¹è¿‡äºé›†ä¸­åœ¨æŸä¸€ä¸ªåŒºï¼ˆå¦‚æ¹–é‡ŒåŒºï¼‰çš„é—®é¢˜ã€‚

**Changes**:

- **Backend Optimization**: ä¿®æ”¹ `GaodeService`ï¼Œç§»é™¤æ ¹æ®ç¬¬ä¸€ä¸ªæ™¯ç‚¹é”å®šæ•´ä¸ªæœç´¢åŒºåŸŸçš„é€»è¾‘ã€‚ç°åœ¨ç¾é£Ÿå’Œé…’åº—æ¨èé»˜è®¤æœç´¢å…¨å¸‚çƒ­é—¨ï¼Œæä¾›æ›´å¤šæ ·åŒ–çš„é€‰æ‹©ã€‚
- **Fix**: ä¿®å¤å‰ç«¯æ­£åˆ™è½¬ä¹‰é—®é¢˜ï¼Œç¡®ä¿åŸå¸‚åèƒ½è¢«æ­£ç¡®ä¼ é€’ç»™åœ°å›¾APIã€‚å¢å¼ºå‰ç«¯åŸå¸‚æå–è§„åˆ™ï¼Œæ”¯æŒâ€œç›®çš„åœ°ï¼šXXâ€ã€â€œXXè¡Œç¨‹â€ã€â€œæ‚¨çš„XXä¹‹æ—…â€ç­‰å¤šç§æ ‡é¢˜æ¨¡å¼ï¼Œå¹¶å¢åŠ åç«¯æ§åˆ¶å°æ—¥å¿—ä»¥ä¾¿äºè¿½è¸ªã€‚

## [2026-01-19 09:50] UI æ ·å¼å¾®è°ƒ

- **Visual Update**: ä¼˜åŒ–äº†è¡Œç¨‹å¡ç‰‡ä¸­ "å®ç”¨å°è´´å£«" (Tips) éƒ¨åˆ†çš„æ˜¾ç¤ºã€‚ç°åœ¨ä½¿ç”¨ `ReactMarkdown` æ¸²æŸ“ï¼Œèƒ½å¤Ÿæ­£ç¡®è§£æ Markdown æ ‡é¢˜ (###)ã€åˆ—è¡¨å’ŒåŠ ç²—ç­‰æ ¼å¼ï¼Œè§£å†³äº†é¢„ç®—æ˜ç»†æ˜¾ç¤ºæ‚ä¹±çš„é—®é¢˜ã€‚

## [2026-01-19 10:00] ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ–

- **Mobile Feature**: ä¸ºç§»åŠ¨ç«¯æ–°å¢äº†åº•éƒ¨å¯¼èˆªæ  (Bottom Navigation)ï¼Œç”¨æˆ·å¯ä»¥åœ¨â€œå¯¹è¯åˆ—è¡¨â€å’Œâ€œè¡Œç¨‹åœ°å›¾â€ä¸¤ä¸ªè§†å›¾é—´è‡ªç”±åˆ‡æ¢ã€‚æ–°å¢äº†**è‡ªåŠ¨è·³è½¬é€»è¾‘**ï¼Œå½“ AI ç”Ÿæˆè¡Œç¨‹åï¼Œç§»åŠ¨ç«¯ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°è¡Œç¨‹è§†å›¾ï¼Œå‡å°‘ä¸€æ­¥æ“ä½œã€‚
- **Responsive**: ä¼˜åŒ–äº† `DayCard` åœ¨ç§»åŠ¨ç«¯çš„æ˜¾ç¤ºï¼Œè°ƒæ•´äº†æ ‡é¢˜ã€æ—¶é—´è½´å’Œæ ‡ç­¾çš„å¸ƒå±€ã€‚
- **UI Cleanup**: ç§»é™¤äº†è¡Œç¨‹æ‘˜è¦å¡ç‰‡ä¸­å†—ä½™çš„â€œæŸ¥çœ‹å³ä¾§è¯¦æƒ…â€æ–‡å­—å’ŒæŒ‰é’®ï¼Œä½¿ç•Œé¢æ›´åŠ ç®€æ´ã€‚
- **Map Enhancement**: ä¼˜åŒ–äº†åœ°å›¾ç»„ä»¶çš„åŠ è½½çŠ¶æ€ (Loading Spinner) å’Œé”™è¯¯å¤„ç†ã€‚ç°åœ¨å½“é«˜å¾·åœ°å›¾â€œçœŸå®è·¯çº¿è§„åˆ’â€å¤±è´¥ï¼ˆå¦‚é…é¢è¶…é™ï¼‰æ—¶ï¼Œä¼šä¼˜é›…é™çº§ä¸ºç›´çº¿è¿æ¥ï¼Œå¹¶æ˜¾ç¤ºæ¸©å’Œçš„é¡¶éƒ¨æç¤ºï¼Œè€Œä¸æ˜¯è®©ç”¨æˆ·ç–‘æƒ‘ã€‚
- **Feature**: å®ç°äº† **å†å²è®°å½•ä¾§è¾¹æ  (History Sidebar)**ã€‚ç”¨æˆ·ç°åœ¨å¯ä»¥ç‚¹å‡»å·¦ä¸Šè§’èœå•æŒ‰é’®æŸ¥çœ‹å†å²å¯¹è¯ï¼Œç‚¹å‡»åˆ‡æ¢ä¼šè¯ï¼Œæˆ–åˆ é™¤æ—§è®°å½•ã€‚æ•°æ®å·²å®ç°æŒä¹…åŒ–å­˜å‚¨ã€‚
- **Geocoding Optimization**: å®æ–½äº†â€œåŒé‡ä¿é™©â€å®šä½æœºåˆ¶ï¼šä¼˜å…ˆç²¾å‡†åœ°å€åŒ¹é…ï¼Œå¤±è´¥åˆ™è‡ªåŠ¨é™çº§ä¸ºâ€œåœ°ç‚¹æ¨¡ç³Šæœç´¢â€ï¼Œå¤§å¹…æé«˜äº†åœ°ç‚¹å®šä½æˆåŠŸç‡ã€‚

## [2026-01-19 14:00] å®‰å…¨ä¸ä½“éªŒåŒé‡å‡çº§

**Action**: å¢å¼ºç³»ç»Ÿå®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒç»†èŠ‚

**Key Updates**:

1.  **Security Hardening (å®‰å…¨åŠ å›º)**:
    - ğŸ”’ **Rate Limiting**: å¼•å…¥äº† `@nestjs/throttler` å…¨å±€é™æµä¸­é—´ä»¶ã€‚
    - **Policy**: é™åˆ¶å• IP æ¯åˆ†é’Ÿæœ€å¤šè¯·æ±‚ **60æ¬¡**ï¼Œæœ‰æ•ˆé˜²æ­¢ API è¢«æ¶æ„åˆ·çˆ†æˆ– DDo Sã€‚
    - **Guard**: å¢åŠ äº†è¯é¢˜æŠ¤æ  (Topic Guard)ï¼Œåœ¨ System Prompt å±‚é¢ä¸¥ç¦ AI å›ç­”éæ—…æ¸¸ç›¸å…³é—®é¢˜ï¼ˆå¦‚å†™ä»£ç ã€èŠå…«å¦ï¼‰ï¼Œç¡®ä¿ä¸“åœ¨ä¸“ç”¨ã€‚

2.  **Context Enhancement (æ™ºèƒ½è®°å¿†)**:
    - ğŸ§  **Context Awareness**: åç«¯ LangChain æœåŠ¡ç°åœ¨ä¼šæ‰«æå®Œæ•´çš„å¯¹è¯å†å²æ¥é”å®šâ€œç›®çš„åœ°åŸå¸‚â€ã€‚
    - **Outcome**: ç”¨æˆ·è¯´â€œå¤ªè´µäº†â€æ—¶ï¼ŒAI ä¸éœ€è¦ç”¨æˆ·å†è¯´ä¸€éåŸå¸‚åï¼Œå°±èƒ½è‡ªåŠ¨ç»“åˆä¹‹å‰çš„åŸå¸‚ä¸Šä¸‹æ–‡é‡æ–°è§„åˆ’ã€‚

3.  **UI/UX**:
    - ğŸ§© **Re-plan Button [Removed]**: åº”ç”¨æˆ·è¦æ±‚ç§»é™¤æ˜¾å¼æŒ‰é’®ï¼Œå®Œå…¨å›å½’è‡ªç„¶è¯­è¨€äº¤äº’ï¼ˆå¦‚â€œæ¢ä¸ªé…’åº—â€ã€â€œè¡Œç¨‹å¤ªèµ¶äº†â€ï¼‰ã€‚
    - ğŸ“ **Enhanced Logging**: åç«¯æ§åˆ¶å°ç°åœ¨ä¼šæ™ºèƒ½æå–å¹¶æ‰“å°â€œå‡ºå‘åœ°â€ã€â€œé¢„ç®—â€ç­‰å…³é”®æ„å›¾ä¿¡æ¯ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚
    - ğŸ” **Tavily Search Integrated**: é›†æˆäº†é«˜çº§æœç´¢å·¥å…· Tavilyï¼Œé…ç½® API Key åè‡ªåŠ¨æ›¿ä»£ DuckDuckGoï¼Œæä¾›æ›´ç¨³å®šå¿«é€Ÿçš„å®æ—¶ä¿¡æ¯æ£€ç´¢ã€‚

## [2026-01-19 16:45] CSS å…¼å®¹æ€§ä¿®å¤

- **Fix**: åœ¨ `Auth.css` ä¸­ä¸º `background-clip` æ·»åŠ æ ‡å‡†å±æ€§ã€‚
- **Reason**: ä¿®å¤ Linter è­¦å‘Š "è¿˜å®šä¹‰æ ‡å‡†å±æ€§â€œbackground-clipâ€ä»¥å®ç°å…¼å®¹æ€§"ï¼Œç¡®ä¿åœ¨é Webkit æµè§ˆå™¨ä¸­çš„æ½œåœ¨å…¼å®¹æ€§ã€‚

## [2026-01-20 08:30] AI ä¸Šä¸‹æ–‡ä¼˜åŒ– - æ™ºèƒ½å‡ºå‘åœ°æ¨æ–­

- **Enhancement**: ä¼˜åŒ– AI System Promptï¼Œå®ç°æ™ºèƒ½å‡ºå‘åœ°æ¨æ–­ã€‚
- **Logic**: å½“ç”¨æˆ·èµ„æ–™ä¸­è®¾ç½®äº†â€œå¸¸å±…åŸå¸‚â€æ—¶ï¼ŒAI å°†è‡ªåŠ¨å°†å…¶ä½œä¸ºé»˜è®¤å‡ºå‘åœ°ï¼Œä¸å†è¯¢é—®ç”¨æˆ·â€œä»å“ªå‡ºå‘â€ï¼Œé™¤éç”¨æˆ·æ˜¾å¼è¦†ç›–ã€‚
- **Impact**: å‡å°‘å†—ä½™å¯¹è¯è½®æ¬¡ï¼Œæå‡ç”¨æˆ·ä½“éªŒçš„è¿è´¯æ€§ã€‚
- **Refinement (2026-01-20 08:50)**: è¿›ä¸€æ­¥å¼ºåŒ–ç³»ç»Ÿæç¤ºè¯ï¼Œä½¿ç”¨æ›´ä¸¥å‰çš„æŒ‡ä»¤ç¦æ­¢ AI åœ¨å·²æœ‰å¸¸å±…åŸå¸‚æ—¶è¯¢é—®å‡ºå‘åœ°ã€‚

## [2026-01-20 08:55] æ—¶é—´æ„ŸçŸ¥èƒ½åŠ›å¢å¼º

- **Feature**: é›†æˆ `TimeTool` (æ—¶é—´å·¥å…·)ï¼Œå…è®¸ AI ä¸»åŠ¨æŸ¥è¯¢å½“å‰çš„ç²¾ç¡®ç³»ç»Ÿæ—¶é—´ã€æ˜ŸæœŸåŠæ—¥æœŸã€‚
- **Context Injection**: åœ¨ç³»ç»Ÿæç¤ºè¯ä¸­ç›´æ¥æ³¨å…¥æœåŠ¡å™¨å®æ—¶æ—¶é—´ (CST)ï¼Œæ¶ˆé™¤æ¨¡å‹çš„æ—¶é—´å¹»è§‰ï¼Œç¡®ä¿è¡Œç¨‹æ—¥æœŸçš„å‡†ç¡®æ€§ã€‚

## [2026-01-20 09:05] æ—¶åŒºè‡ªé€‚åº” (User-Based Timezone)

- **Feature**: ç³»ç»Ÿç°åœ¨ä¼š**è‡ªåŠ¨æ£€æµ‹ç”¨æˆ·æµè§ˆå™¨æ—¶åŒº**ï¼ˆå¦‚ `America/New_York` æˆ– `Asia/Tokyo`ï¼‰ï¼Œä¸å†å¼ºåˆ¶é”å®šåŒ—äº¬æ—¶é—´ã€‚
- **Implementation**:
  - å‰ç«¯ï¼šè‡ªåŠ¨æ•è· `Intl.DateTimeFormat().resolvedOptions().timeZone` å¹¶é€šè¿‡ `X-Timezone` è¯·æ±‚å¤´å‘é€ã€‚
  - åç«¯ï¼šAI å¯¹è¯å¼•æ“å’Œ `TimeTool` å‡åŠ¨æ€æ¥æ”¶æ­¤æ—¶åŒºå‚æ•°ï¼Œç¡®ä¿æ—¶é—´å›ç­”ä¸ç”¨æˆ·æ‰€åœ¨åœ°å®Œå…¨åŒæ­¥ã€‚

## [2026-01-20 08:35] ä¸ªäººä¸­å¿ƒä½“éªŒå‡çº§ - å¤šé€‰ä¸äº¤äº’ä¼˜åŒ–

- **Feature**: ä¸ªäººåå¥½è®¾ç½®ä¸­çš„â€œæ—…è¡Œé£æ ¼â€ç°åœ¨æ”¯æŒ**å¤šé€‰**ï¼ˆå¦‚åŒæ—¶é€‰æ‹©â€œä¼‘é—²æ”¾æ¾â€å’Œâ€œç¾é£Ÿä¹‹æ—…â€ï¼‰ï¼Œè®© AI èƒ½å¤Ÿç”Ÿæˆæ›´ç¬¦åˆå¤åˆéœ€æ±‚çš„è¡Œç¨‹ã€‚
- **UX Improvement**: ä¿å­˜æˆåŠŸåçš„æç¤ºæ–¹å¼ä»ä¸èµ·çœ¼çš„æ–‡å­—æ”¹ä¸ºäº†**å¼¹çª— (Modal Alert)**ï¼Œç»™ç”¨æˆ·æ›´æ˜ç¡®çš„åé¦ˆã€‚
- **Refactor**: æ›´æ–°äº†å‰ç«¯ç±»å‹å®šä¹‰ä»¥åŒ¹é…æ–°çš„æ•°æ®ç»“æ„ã€‚

## [2026-01-20 09:15] ç¨³å®šæ€§ä¿®å¤ (Stabilization)

- **Fix**: ä¿®å¤å‰ç«¯ `ChatInterface` å’Œ `MessageBubble` å› æ¶ˆæ¯å†…å®¹éå­—ç¬¦ä¸²å¯¼è‡´çš„å´©æºƒé—®é¢˜ (Crash Loop Fix)ã€‚
- **Fix**: ä¿®å¤ Vite HMR çƒ­æ›´æ–°æŠ¥é”™ï¼Œæ­£ç¡®éš”ç¦» `AuthContext` ä¸­çš„ç±»å‹å¯¼å‡ºã€‚
- **Fix**: ä¿®å¤åç«¯ `ChatController` è¿”å›å®Œæ•´æ¶ˆæ¯å¯¹è±¡å¯¼è‡´å‰ç«¯æ˜¾ç¤º JSON ä¹±ç çš„é—®é¢˜ã€‚
- **Fix**: ä¿®å¤ `JwtStrategy` æœªæŸ¥è¯¢æ•°æ®åº“å¯¼è‡´ AI æ— æ³•è·å–ç”¨æˆ·å®Œæ•´åå¥½ (å¸¸å±…åœ°/æ—…è¡Œé£æ ¼) çš„é—®é¢˜ã€‚

## [2026-01-20 09:30] æ ¸å¿ƒåŠŸèƒ½éªŒè¯ (Verification)

- **Validated**: ç¡®è®¤ç”¨æˆ·èµ„æ–™ (Personal Profile) ä¸­çš„â€œå¸¸å±…åŸå¸‚â€å’Œâ€œæ—…è¡Œé£æ ¼â€å·²æ­£ç¡®é€šè¿‡ JWTé“¾è·¯ ä¼ é€’å¹¶æ³¨å…¥åˆ° AI System Prompt ä¸­ã€‚
- **Status**: ç³»ç»Ÿå·²ç¨³å®šï¼Œæ—¶åŒºè‡ªé€‚åº”ã€åå¥½è®°å¿†å’Œæµå¼å“åº”å‡æ­£å¸¸å·¥ä½œã€‚

## [2026-01-20 09:45] è¡Œç¨‹å±•ç¤ºä½“éªŒä¼˜åŒ– (UI Polish)

- **Fix (Weather)**: å¢åŠ äº†å¤©æ°”æœåŠ¡çš„è¶…æ—¶æ—¶é—´ (3s -> 8s)ï¼Œè§£å†³äº†éƒ¨åˆ†åŸå¸‚å¤©æ°”åŠ è½½å¤±è´¥çš„é—®é¢˜ã€‚
- **Fix (Parser)**: ä¿®å¤äº†â€œå®ç”¨å°è´´å£«â€è§£æé€»è¾‘ï¼Œé˜²æ­¢â€œé¢„ç®—æ˜ç»†â€ç­‰åç»­æ®µè½è¢«é”™è¯¯åŒ…å«åœ¨ Tips æ¡†ä¸­ã€‚
- **UI (Index)**: ä¿®æ­£äº†è¡Œç¨‹å¤©æ•°åºå·æ˜¾ç¤ºé—®é¢˜ (ä» 1 å¼€å§‹è®¡æ•°)ã€‚
- **UI (Price)**: ä¼˜åŒ–äº†ä»·æ ¼æ˜¾ç¤ºé€»è¾‘ï¼Œé‡‘é¢ä¸º 0 æˆ– 0å…ƒ æ—¶ç›´æ¥æ˜¾ç¤ºæ›´åŠ å‹å¥½çš„â€œå…è´¹â€æ ‡ç­¾ã€‚

## [2026-01-20 10:15] ç”¨æˆ·ä½“éªŒä¼˜åŒ– (UX Improvements)

- **Feat**: æ–°å¢â€œä¸ªäººåå¥½å®Œå–„æé†’â€åŠŸèƒ½ã€‚å½“ç”¨æˆ·æœªè®¾ç½®å¸¸å±…åŸå¸‚æ—¶ï¼Œä¼šåœ¨ç™»å½•åæç¤ºå‰å¾€è®¾ç½®ï¼Œç¡®ä¿ AI è¡Œç¨‹è§„åˆ’æ‹¥æœ‰å¿…è¦çš„ä¸Šä¸‹æ–‡ã€‚
- **Fix (Stream)**: å½»åº•é‡æ„ LangChainæµå¼è°ƒç”¨é€»è¾‘ï¼Œæ”¯æŒå¤šæ­¥å·¥å…·è¿ç»­è°ƒç”¨ (Loop)ï¼Œä¸å†å‡ºç°å“åº”ä¸­æ–­é—®é¢˜ã€‚

## [2026-01-20 10:45] AI JSON æ ¼å¼è¿ç§»

- **Backend**: Updated System Prompt to utilize strict JSON Schema for output, replacing Markdown tables.
- **Frontend**:
  - Implemented `parseItineraryContent` to support both JSON and legacy Markdown.
  - Switched `useChat` to utilize non-streaming API for atomic data parsing.
  - Updated `ChatInterface` and `MessageBubble` to gracefully handle JSON plan data.

## [2026-01-20 10:52] Syntax & Stability Fixes

- **Backend Fixes**:
  - `langchain.service.ts`: Fixed unescaped backticks in System Prompt and corrupted template literals in logging that caused widespread "Cannot find name" compilation errors.
  - Re-enabled `weekday` calculation logic.

- **Frontend Fixes**:
  - `useItineraryParser.ts`: Removed invalid markdown code fence (` \`\`\` `) at start of file and updated to use `parseItineraryContent`.
  - `MessageBubble.tsx`: Reconstructed file to fix malformed JSX structure, syntax errors, and missing imports. Added proper "JSON Plan" display logic.
  - `itineraryParser.ts`: Removed duplicate `mapTypeToEn` symbol.
  - `ItinerarySummaryCard.tsx`: Updated to use `parseItineraryContent` to support both JSON and Markdown formats.

## [2026-01-20 10:55] UI Optimization (JSON Display)

- **Feature**: Implemented `CompactItineraryView` component to display a concise day-by-day summary in the chat bubble for JSON itinerary key.
- **UX**: Replaced the generic "Plan Generated" placeholder with the new compact view, providing immediate value in the chat stream while keeping detailed info in the side panel.

## [2026-01-20 11:00] Chat UI Polish

- **Fix**: Resolved User message bubble alignment issue by standardizing CSS class names (`user`/`assistant`).
- **Fix**: Added JSON parsing logic for `type: "question"` messages to ensure AI questions are displayed as natural text instead of raw JSON code.

## [2026-01-20 11:05] Fix Itinerary Panel Data Flow

- **Fix**: Updated `ChatInterface.tsx` to correctly detect JSON-formatted itinerary plans (`"type": "plan"`) when extracting the latest itinerary content. Previously, it only recognized legacy Markdown tables, causing the right-side panel to remain empty for New JSON responses.

## [2026-01-20 11:10] Chat Bubble Visibility Improvement

- **UI**: Enhanced contrast for chat bubbles.
  - **User Bubble**: Added solid blue fallback, increased font weight, and refined border radius.
  - **AI Bubble**: Removed glassmorphism transparency for a solid white background with stronger borders and shadows to improve readability against light backgrounds.
