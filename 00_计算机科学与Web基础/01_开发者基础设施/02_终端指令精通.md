# 02. 终端指令精通 (Terminal Mastery) - 侦探实战

不要死记硬背参数。在这个模块，我们将化身**服务器侦探**，通过排查一个真实的问题场景来掌握终端指令。

## 🛠️ 准备工作：Windows 用户必读

本课程所有命令基于 **Linux/Mac** 标准。
**Windows 用户请务必使用 Git Bash** 运行命令，**不要使用**默认的 CMD 或 PowerShell，否则很多命令（如 `ls -la`, `grep`, `wc`）会报错或行为不一致。

1.  安装 [Git for Windows](https://gitforwindows.org/)。
2.  在任意文件夹右键 -> "Open Git Bash here"。

---

---

## 🎭 场景：网站挂了？！ (The Incident)

你的老板突然冲过来说：“网站打不开了！快看看服务器怎么了！”
你登录到了服务器终端。开始破案。

### 第一步：案发现场 (ls, cd, mkdir)

首先，我们需要找到日志文件在哪里。

```bash
# 看看当前在哪里
pwd
# /home/admin

# 列出所有文件（包括隐藏的）
ls -la

# 进入日志目录（如果没有就建一个模拟一下）
mkdir -p /var/log/myapp
cd /var/log/myapp
```

### 第二步：制造线索 (touch, echo)

(为了演示，我们先伪造一个日志文件)

```bash
# 创建一个空的日志文件
touch access.log

# 往里塞点数据（模拟正常访问和报错）
echo "[INFO] User login success" >> access.log
echo "[ERROR] Database connection failed: Timeout" >> access.log
echo "[INFO] User profile updated" >> access.log
echo "[ERROR] Database connection failed: Wrong Password" >> access.log
echo "[INFO] Payment success" >> access.log
```

> **技巧**：`>>` 是追加写入，`>` 是覆盖写入。小心使用 `>`！

### 第三步：搜集证据 (cat, head, tail)

日志文件可能很大（几百 MB），直接打开会卡死。

```bash
# ❌ 错误做法：直接 cat 刷屏
# cat access.log

# ✅ 正确做法 1：只看最新的 10 行（通常报错都在最后）
tail -n 10 access.log

# ✅ 正确做法 2：实时监控（盯着屏幕看有没有新报错滚出来）
# (按 Ctrl+C 退出)
tail -f access.log
```

### 第四步：精准定位 (grep)

日志太多了，我只想看“报错” (ERROR)。

```bash
# 搜索包含 "ERROR" 的行
grep "ERROR" access.log

# 输出:
# [ERROR] Database connection failed: Timeout
# [ERROR] Database connection failed: Wrong Password
```

### 第五步：组合拳 (Pipe `|`)

**这是 Linux 的灵魂**。我们要统计一下到底有多少个 ERROR。
我们将 `grep` 的输出，“流”给 `wc` (Word Count) 命令。

```bash
# 找 ERROR -> 统计行数 (-l)
grep "ERROR" access.log | wc -l
# 输出: 2
```

破案了！有 2 次数据库连接失败。

---

## 🔧 场景二：清理战场 (File Ops)

案子破了，我们需要备份日志，然后清理旧文件。

```bash
# 1. 备份日志 (cp)
# 把 access.log 复制为 access.log.bak
cp access.log access.log.bak

# 2. 归档 (mv)
# 把备份文件移动到 /tmp 目录
mv access.log.bak /tmp/

# 3. 删库跑路...啊不，删除临时文件 (rm)
# ⚠️ 高危操作：看清楚自己在删什么！
rm -f /tmp/access.log.bak
```

---

## 📡 场景三：网络连通性 (Network)

老板问：“数据库连不上，是不是网断了？”

```bash
# 1. ping 一下百度或者内网 IP，看看通不通
ping www.baidu.com
# 64 bytes from ... time=12.3 ms (通了)

# 2. 看看谁占用了 8080 端口（是不是服务没起起来？）
lsof -i :8080
# 如果没输出，说明端口没人用（服务挂了）

# 3. 模拟发一个请求
curl -v http://localhost:8080
# -v 可以看到 TCP 握手和 HTTP 头信息，调试 API 神器
```

---

> 💡 **核心最佳实践 (Best Practices)**
>
> 1.  **Tab 键走天下**：打文件路径时，打前两个字母按 `Tab`，让系统自动补全。既快又不会拼错。
> 2.  **Ctrl+R 找历史**：想重复执行刚才那个很长的命令？按 `Ctrl+R`，输入关键词（比如 "grep"），Git Bash 会自动搜索你的历史命令。
> 3.  **管道思维**：不要想着一个命令解决所有问题。用 `|` 把简单命令串起来，威力无穷。比如 `ps aux | grep node | grep -v grep` (查找 node 进程)。
